{"version":3,"file":"lenis.umd.js","sources":["../src/lenis.js","../src/maths.js"],"sourcesContent":["import EventEmitter from 'tiny-emitter'\nimport VirtualScroll from 'virtual-scroll'\nimport { clamp, lerp } from './maths.js'\n\nexport default class Lenis extends EventEmitter {\n  constructor({ lerp = 0.1, smooth = true } = {}) {\n    super()\n\n    this.lerp = lerp\n    this.smooth = smooth\n\n    window.addEventListener('scroll', this.onScroll, false)\n    window.addEventListener('resize', this.onWindowResize, false)\n\n    const platform =\n      navigator?.userAgentData?.platform || navigator?.platform || 'unknown'\n\n    // listen and normalize wheel event cross-browser\n    this.virtualScroll = new VirtualScroll({\n      firefoxMultiplier: 50,\n      mouseMultiplier: platform.indexOf('Win') > -1 ? 1 : 0.4,\n      useKeyboard: false,\n      useTouch: false,\n      passive: false,\n    })\n\n    this.virtualScroll.on(this.onVirtualScroll)\n\n    this.onWindowResize()\n    this.maxScroll = document.body.offsetHeight - this.windowHeight\n\n    // recalculate maxScroll when body height changes\n    this.resizeObserver = new ResizeObserver(this.onResize)\n    this.resizeObserver.observe(document.body)\n\n    this.targetScroll = this.scroll = window.scrollY\n  }\n\n  start() {\n    this.stopped = false\n  }\n\n  stop() {\n    this.stopped = true\n  }\n\n  destroy() {\n    window.removeEventListener('scroll', this.onScroll, false)\n    window.removeEventListener('resize', this.onWindowResize, false)\n    this.virtualScroll.destroy()\n    this.resizeObserver.disconnect()\n  }\n\n  onResize = (entries) => {\n    const entry = entries[0]\n    if (entry) {\n      const rect = entry.contentRect\n      this.maxScroll = rect.height - this.windowHeight\n    }\n  }\n\n  onWindowResize = () => {\n    this.windowHeight = window.innerHeight\n    this.windowWidth = window.innerWidth\n  }\n\n  onVirtualScroll = ({ deltaY, originalEvent: e }) => {\n    // detect potential nested scrollable elements\n    // const path = e.path || (e.composedPath && e.composedPath())\n    // const isNestedScroll = path\n    //   .filter((element) => element.tagName) // filter node elements\n    //   .find((element, i) => {\n    //     return (\n    //       ['auto', 'scroll'].includes(getComputedStyle(element).overflowY) &&\n    //       element.scrollHeight > element.clientHeight\n    //     )\n    //   }) // filter scrollable elements\n\n    // if (isNestedScroll) return\n\n    if (this.stopped) {\n      e.preventDefault()\n      return\n    }\n\n    if (this.smooth && !e.ctrlKey) e.preventDefault()\n\n    this.targetScroll -= deltaY\n    this.targetScroll = clamp(0, this.targetScroll, this.maxScroll)\n  }\n\n  raf() {\n    if (!this.smooth || this.stopped) return\n\n    // lerp scroll value\n    this.scroll = lerp(this.scroll, this.targetScroll, this.lerp)\n    if (Math.round(this.scroll) === Math.round(this.targetScroll)) {\n      this.scroll = this.targetScroll\n    }\n\n    if (this.scrolling) {\n      // scroll to lerped scroll value\n      window.scrollTo(0, this.scroll)\n      this.emit('scroll', { scroll: this.scroll })\n    }\n\n    this.scrolling = this.scroll !== this.targetScroll\n  }\n\n  onScroll = (e) => {\n    // if scrolling is false we can estimate you aren't scrolling with wheel (cmd+F, keyboard or whatever). So we must scroll to without any easing\n    if (!this.scrolling || !this.smooth) {\n      this.targetScroll = this.scroll = window.scrollY\n      this.emit('scroll', { scroll: this.scroll })\n    }\n  }\n\n  scrollTo(target, { offset = 0 } = {}) {\n    let y\n\n    if (typeof target === 'number') {\n      // Number\n      y = target\n    } else if (target === '#top') {\n      y = 0\n    } else if (target === '#bottom') {\n      y = this.maxScroll\n    } else {\n      let node\n\n      if (typeof target === 'string') {\n        // CSS selector\n        node = document.querySelector(target)\n      } else if (target?.nodeType) {\n        // Node element\n        node = target\n      } else {\n        return\n      }\n\n      if (!target) return\n      y = node.getBoundingClientRect().top + this.scroll\n    }\n\n    y += offset\n\n    this.targetScroll = y\n    this.scrolling = true\n    if (!this.smooth) {\n      this.scroll = y\n    }\n  }\n}\n","export function clamp(min, input, max) {\n  return input < min ? min : input > max ? max : input\n}\n\nexport function mapRange(in_min, in_max, input, out_min, out_max) {\n  return ((input - in_min) * (out_max - out_min)) / (in_max - in_min) + out_min\n}\n\nexport function lerp(start, end, amt) {\n  return (1 - amt) * start + amt * end\n}\n\nexport function truncate(value, decimals) {\n  return parseFloat(value.toFixed(decimals))\n}\n"],"names":["Lenis","_temp","_navigator","_navigator$userAgentD","_navigator2","_this","_ref","_ref$lerp","lerp","smooth","_ref$smooth","_EventEmitter","call","this","onResize","entries","entry","maxScroll","contentRect","height","windowHeight","onWindowResize","window","innerHeight","windowWidth","innerWidth","onVirtualScroll","_ref2","deltaY","input","max","e","originalEvent","stopped","preventDefault","ctrlKey","targetScroll","onScroll","scrolling","scroll","scrollY","emit","addEventListener","platform","navigator","userAgentData","virtualScroll","VirtualScroll","firefoxMultiplier","mouseMultiplier","indexOf","useKeyboard","useTouch","passive","on","document","body","offsetHeight","resizeObserver","ResizeObserver","observe","EventEmitter","start","stop","destroy","removeEventListener","disconnect","raf","amt","Math","round","scrollTo","target","_temp2","y","offset","_ref3$offset","node","querySelector","nodeType","getBoundingClientRect","top"],"mappings":"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"}