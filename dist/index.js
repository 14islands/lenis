Object.defineProperty(exports,"__esModule",{value:!0});var EventEmitter=require("events");function _interopDefaultLegacy(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var EventEmitter__default=_interopDefaultLegacy(EventEmitter);function clamp(t,e,s){return e<t?t:s<e?s:e}function lerp(t,e,s){return(1-s)*t+s*e}function truncate(t,e){return parseFloat(t.toFixed(e))}function offsetTop(t,e=0){e+=t.offsetTop;return t.offsetParent?offsetTop(t.offsetParent,e):e}function offsetLeft(t,e=0){e+=t.offsetLeft;return t.offsetParent?offsetLeft(t.offsetParent,e):e}class Rect{constructor(t){this.element=t,this.update()}update(){this.windowWidth=Math.min(document.documentElement.clientWidth,window.innerWidth),this.windowHeight=Math.min(document.documentElement.clientHeight,window.innerHeight),this.top=offsetTop(this.element),this.left=offsetLeft(this.element);var{width:t,height:e}=this.element.getBoundingClientRect();this.width=t,this.height=e,this.right=this.left+this.width,this.bottom=this.top+this.height}computeRect(t=0,e=0){return{top:this.top-e,left:this.left-t,height:this.height,width:this.width,bottom:this.windowHeight-(this.top-e+this.height),right:this.windowWidth-(this.left-t+this.width)}}computeIntersection(t,e,s=0){t=this.computeRect(t,e);return t.top+t.height>-s&&t.bottom+t.height>-s}}class ScrollElement extends Rect{constructor(t){super(t);let e=t.getAttribute("data-scroll-speed");e=t.speed=parseFloat(e),e=isNaN(e)?0:e,this.speed=e/10,this.inView=!1,this.call=t.getAttribute("data-scroll-call"),this.delay=t.getAttribute("data-scroll-delay"),this.delay=this.delay?parseFloat(this.delay):null,this.repeat=null!==t.getAttribute("data-scroll-repeat"),this.direction=t.getAttribute("data-scroll-direction"),this.position=t.getAttribute("data-scroll-position"),this.sticky=null!==t.getAttribute("data-scroll-sticky"),this.offset=t.getAttribute("data-scroll-offset"),this.offset?this.offset=this.offset.replaceAll(" ","").split(",").map(t=>["top","bottom"].includes(t)?0:t):this.offset=[0,0],this.offset=new Array(2).fill(0).map((t,e)=>this.offset[e]||0),this.target=document.querySelector(t.getAttribute("data-scroll-target")),this.target&&(this.target=new Rect(this.target))}update(){super.update()}}const defaultOptions={autoRaf:!0,smooth:.88,direction:"vertical",effects:!0};class Lenis extends EventEmitter__default.default{constructor(t={}){var e,s,i,o,l;super(),this.setMaxListeners(1/0),this.options={...defaultOptions,...t},this.options.wrapper&&this.options.content?(this.options.lerp=this.options.smooth+0,this.options.lerp=isNaN(parseFloat(this.options.lerp))?defaultOptions.lerp:parseFloat(this.options.lerp),this.options.lerp=clamp(.01,1-this.options.lerp,1),this.options.smooth=this.options.lerp<1,document.documentElement.classList.add("has-scroll-init"),{wrapper:t,content:e,direction:s,smooth:i,lerp:o,effects:l}=this.options,this.wrapperElement=t,this.wrapperElement.addEventListener("scroll",this.onWrapperScroll,!1),this.contentElement=e,this.direction=s,this.smooth=i,this.lerp=o,this.effects=l,this.delta={x:window.scrollX,y:window.scrollY},this.scroll={x:window.scrollX,y:window.scrollY},this.latestScroll={x:window.scrollX,y:window.scrollY},this.update(),window.addEventListener("scroll",this.onScroll,!1),window.addEventListener("resize",this.update,!1),document.addEventListener("focus",this.onFocus,!0),this.anchors=[...document.querySelectorAll("a[href^='#'], [data-scroll-to]")],this.anchorsHandler=t=>{t.preventDefault();t=t.currentTarget.getAttribute("href")||t.currentTarget.getAttribute("data-scroll-to"),t=document.querySelector(t);this.scrollTo(t)},this.anchors.forEach(t=>{t.addEventListener("click",this.anchorsHandler,!1)}),!0===this.options.smooth&&document.documentElement.classList.add("has-scroll-smooth"),this.options.autoRaf&&requestAnimationFrame(this.raf)):console.warn("lenis: missing wrapper or content")}get velocity(){return{x:this.scroll.x-this.latestScroll.x,y:this.scroll.y-this.latestScroll.y}}get progress(){var t=truncate(this.scroll.x/this.limit.x,4),e=truncate(this.scroll.y/this.limit.y,4);return{x:isNaN(t)?0:t,y:isNaN(e)?0:e}}scrollTo(t,e={}){var s,i,o=parseInt(e.offset)||0,e=e.immediate||!1;if("string"==typeof t){if("top"===t)t=0;else if("bottom"===t)t=this.limit.y;else if("left"===t)t=0;else if("right"===t)t=this.limit.x;else if(!(t=document.querySelector(t)))return}else if("number"==typeof t)t=parseInt(t);else if(!t||!t.tagName)return void console.warn("`target` parameter is not valid");"number"!=typeof t&&(s=offsetTop(t),i=offsetLeft(t),t="horizontal"===this.direction?i:s),t+=o,"horizontal"===this.direction?this.setScroll(t,this.delta.y,e):this.setScroll(this.delta.x,t,e)}onScroll=()=>{this.delta={x:window.scrollX,y:window.scrollY},this.isMoving=!0};onFocus=({target:t})=>{var e=offsetTop(t);this.scrollTo(e,{offset:-(this.windowHeight/2-t.offsetHeight/2)})};onWrapperScroll=()=>{this.wrapperElement.scrollTo(0,0)};setScroll(t,e,s=!0){window.scrollTo(t,e),s&&(this.delta={x:t,y:e},this.scroll={x:t,y:e},this.latestScroll={x:t,y:e})}raf=()=>{this.options.autoRaf&&requestAnimationFrame(this.raf),this.isMoving&&(this.latestScroll={x:this.scroll.x,y:this.scroll.y},this.scroll={x:lerp(this.scroll.x,this.delta.x,this.lerp),y:lerp(this.scroll.y,this.delta.y,this.lerp)},this.emit("scroll",{scroll:this.scroll,delta:this.delta,progress:this.progress,velocity:this.velocity,limit:this.limit,currentElements:this.scrollElements.filter(t=>t.inView)}),0===truncate(this.velocity.x,4)&&0===truncate(this.velocity.y,4)&&(this.isMoving=!1),this.applyTransforms())};update=()=>{console.log("lenis update"),this.contentHeight=this.contentElement.offsetHeight,this.contentWidth=this.contentElement.offsetWidth,this.smooth&&document.body.style.setProperty("height",this.contentHeight+"px"),this.windowWidth=Math.min(document.documentElement.clientWidth,window.innerWidth),this.windowHeight=Math.min(document.documentElement.clientHeight,window.innerHeight),this.limit={x:document.body.clientWidth-this.windowWidth,y:document.body.clientHeight-this.windowHeight},this.sections=[...this.contentElement.querySelectorAll("[data-scroll-section]")].map(t=>new Rect(t)),this.scrollElements=[...this.contentElement.querySelectorAll("[data-scroll],[data-scroll-speed],[data-scroll-sticky]")].map(t=>new ScrollElement(t)),this.applyTransforms()};applyTransforms(){this.smooth&&(0<this.sections.length?this.sections.forEach(t=>{t.computeIntersection(this.scroll.x,this.scroll.y,this.windowHeight/2)?(t.element.style.removeProperty("pointer-events"),t.element.style.removeProperty("visibility"),t.element.style.setProperty("transform",`translate3d(${-this.scroll.x}px, ${-this.scroll.y}px, 0)`)):(t.element.style.setProperty("pointer-events","none"),t.element.style.setProperty("visibility","hidden"),t.element.style.removeProperty("transform"))}):this.contentElement.style.setProperty("transform",`translate3d(${-this.scroll.x}px, ${-this.scroll.y}px, 0)`));let E=!1;this.scrollElements.forEach(s=>{if(this.effects){var t=this.scroll.x+this.windowWidth,i=this.scroll.y+this.windowHeight;const v=this.scroll.x+this.windowWidth/2,x=this.scroll.y+this.windowHeight/2;let e=!1;if(s.speed){var o=s.computeIntersection(this.scroll.x,this.scroll.y,this.windowHeight/2),{top:l,left:r,height:n,width:h}=s;if(o)switch(s.position){case"top":e=this.scroll.y*-s.speed;break;case"elementTop":e=(i-l)*-s.speed;break;case"bottom":e=(this.limit.y-i+this.windowHeight)*s.speed;break;case"left":e=this.scroll.x*-s.speed;break;case"elementLeft":e=(t-r)*-s.speed;break;case"right":e=(this.limit.x-t+this.windowHeight)*s.speed;break;default:e="horizontal"===this.direction?(v-(r+h/2))*-s.speed:(x-(l+n/2))*-s.speed}E="horizontal"===this.direction?s.computeIntersection(this.scroll.x-e,this.scroll.y):s.computeIntersection(this.scroll.x,this.scroll.y-e)}else if(s.sticky&&s.target){var o=s.target.computeIntersection(this.scroll.x,this.scroll.y,this.windowHeight/2),{height:c,width:a,top:d,left:p}=s.computeRect(this.scroll.x,this.scroll.y),{top:m,height:f,left:u,right:y,width:w,bottom:g}=s.target.computeRect(this.scroll.x,this.scroll.y);let t=s.offset;t.includes("center")?("horizontal"===this.direction?t[0]=this.windowWidth/2-a/2:t[0]=this.windowHeight/2-c/2,t[1]=0):t=t.map(t=>"string"==typeof t&&t.includes("%")?parseFloat(t.replaceAll("%",""))/100*("horizontal"===this.direction?this.windowWidth:this.windowHeight):t),t[0]=parseFloat(t[0]),t[1]=parseFloat(t[1]),o&&(e="horizontal"===this.direction?clamp(0,-u+t[0],w-a-t[1]+(u-p)):clamp(0,-m+t[0],f-c-t[1]+(m-d))),E="horizontal"===this.direction?p+w>t[1]&&0<y+w:d+f>t[1]&&0<g+f}else E=s.computeIntersection(this.scroll.x,this.scroll.y,0);!1!==e&&(s.delay&&(o=s.translate||0,e=lerp(o,e,s.delay),s.translate=e),"horizontal"===s.direction||"horizontal"===this.direction&&"vertical"!==s.direction?s.element.style.setProperty("transform",`translate3d(${e}px, 0, 0)`):s.element.style.setProperty("transform",`translate3d(0, ${e}px, 0)`))}else E=s.computeIntersection(this.scroll.x,this.scroll.y,0);s.call&&s.inView!==E&&this.emit("call",s.call,E,s),(s.inView=E)?s.element.classList.add("is-inview"):s.repeat&&s.element.classList.remove("is-inview")})}destroy(){this.wrapperElement.removeEventListener("scroll",this.onWrapperScroll,!1),document.removeEventListener("focus",this.onFocus,!0),window.removeEventListener("scroll",this.onScroll,!1),window.removeEventListener("resize",this.update,!1),document.documentElement.classList.remove("has-scroll-init"),document.documentElement.classList.remove("has-scroll-smooth"),cancelAnimationFrame(this.raf),document.body.style.removeProperty("height"),this.anchors.forEach(t=>{t.removeEventListener("click",this.anchorsHandler,!1)}),this.anchors=[],this.sections.forEach(t=>{t.element.style.removeProperty("transform"),t.element.style.removeProperty("pointer-events"),t.element.style.removeProperty("visibility")}),this.sections=[],this.scrollElements.forEach(t=>{t.element.style.removeProperty("transform"),t.element.classList.remove("is-inview")}),this.scrollElements=[]}}exports.default=Lenis;
//# sourceMappingURL=index.js.map
