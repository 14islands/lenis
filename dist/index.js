Object.defineProperty(exports,"__esModule",{value:!0});var EventEmitter=require("events");function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var EventEmitter__default=_interopDefaultLegacy(EventEmitter);function lerp(e,t,s){return(1-s)*e+s*t}function truncate(e,t){return parseFloat(e.toFixed(t))}function getTranslate(e){e=new DOMMatrixReadOnly(window.getComputedStyle(e).getPropertyValue("transform"));return{translateX:e.m41,translateY:e.m42}}class BoundingClientRect{constructor(e){this.element=e,this.update()}update(){var{width:e,height:t,top:s,left:o}=this.element.getBoundingClientRect(),{translateX:e,translateY:t}=(this.width=e,this.height=t,getTranslate(this.element));this.offsetTop=s-t,this.offsetLeft=o-e}}class Scrollbar{constructor(e){this.lenis=e,this.element=document.createElement("div"),this.thumb=document.createElement("div"),this.element.classList.add("lenis-scrollbar"),this.thumb.classList.add("lenis-scrollbar-thumb"),this.element.appendChild(this.thumb),document.body.appendChild(this.element),this.onWindowResize(),window.addEventListener("resize",this.onWindowResize,!1),this.element.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mouseup",this.onMouseUp,!1)}onMouseDown=({clientY:e})=>{this.mouseDown=!0;e/=this.windowHeight;window.scrollTo(0,e*this.lenis.limit)};onMouseMove=({clientY:e})=>{this.mouseDown&&(e=e/this.windowHeight,window.scrollTo(0,e*this.lenis.limit))};onMouseUp=()=>{this.mouseDown=!1};destroy(){window.removeEventListener("resize",this.onWindowResize,!1),this.element.removeEventListener("mousedown",this.onMouseDown,!1),window.removeEventListener("mousemove",this.onMouseMove,!1),window.removeEventListener("mouseup",this.onMouseUp,!1)}update(){this.height=this.thumb.offsetHeight}onWindowResize=()=>{this.windowWidth=Math.min(document.documentElement.clientWidth,window.innerWidth),this.windowHeight=Math.min(document.documentElement.clientHeight,window.innerHeight),this.update()};transform(e){this.thumb.style.transform=`translateY(${e*(this.windowHeight-this.height)+"px"})`}}class Lenis extends EventEmitter__default.default{constructor({wrapper:e,content:t,lerp:s=.1,smooth:o=!0,customScrollbar:i=!0,debug:n=!1}){super(),this.setMaxListeners(1/0),this.customScrollbar=i,this.smooth=o,this.lerp=s,this.wrapper=e,this.content=t,this.debug=n,this.height=this.content.offsetHeight,this.smooth&&(document.body.style.height=this.height+"px"),this.wrapper.setAttribute("data-scroll-wrapper",!0),this.content.setAttribute("data-scroll-content",!0),document.documentElement.classList.add("lenis"),document.documentElement.classList.toggle("lenis-smooth",this.smooth),this.preventTransforms=!1,this.customScrollbar&&(this.scrollbar=new Scrollbar(this)),this.onWindowResize(),window.addEventListener("scroll",this.onWindowScroll,!1),window.addEventListener("resize",this.onWindowResize,!1),window.addEventListener("keydown",this.onKeyDown,!1),this.focus=!0,window.addEventListener("focus",this.onFocus,!1),window.addEventListener("blur",this.onBlur,!1)}onKeyDown=e=>{"Tab"===e.key&&this.applyTransforms(!0)};onFocus=()=>{this.debug&&console.log("Lenis onFocus"),this.focus=!0,this.applyTransforms(!0)};onBlur=()=>{this.debug&&console.log("Lenis onBlur"),this.focus=!1,this.applyTransforms(!0)};destroy(){document.body.style.removeProperty("height"),window.removeEventListener("scroll",this.onWindowScroll,!1),window.removeEventListener("resize",this.onWindowResize,!1),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("focus",this.onFocus,!1),window.removeEventListener("blur",this.onBlur,!1),this.wrapper.removeAttribute("data-scroll-wrapper",!0),this.content.removeAttribute("data-scroll-content",!0),document.documentElement.classList.remove("lenis"),document.documentElement.classList.remove("lenis-smooth"),this.scrollbar&&this.scrollbar.destroy()}update(){this.debug&&console.log("Lenis update"),this.height=this.content.offsetHeight,this.smooth&&(document.body.style.height=this.height+"px"),this.scroll={x:window.scrollX,y:window.scrollY},this.lerpedScroll={x:window.scrollX,y:window.scrollY},this.scrollbar&&this.scrollbar.update(),this.sections=[...document.querySelectorAll("[data-scroll-section]")].map(e=>new BoundingClientRect(e)),this.sections.forEach(e=>{e.update()}),this.emit("scroll",{scroll:this.scroll,lerpedScroll:this.lerpedScroll}),this.applyTransforms(!0)}onWindowResize=()=>{this.debug&&console.log("Lenis onWindowResize"),this.windowWidth=Math.min(document.documentElement.clientWidth,window.innerWidth),this.windowHeight=Math.min(document.documentElement.clientHeight,window.innerHeight),this.update()};onWindowScroll=()=>{this.scroll.x=window.scrollX,this.scroll.y=window.scrollY,!1!==this.focus&&!1!==this.smooth||(this.lerpedScroll.x=this.scroll.x,this.lerpedScroll.y=this.scroll.y,this.applyTransforms(!0))};raf(){let e=!1;truncate(this.lerpedScroll.y,0)===this.scroll.y?(this.lerpedScroll.x=this.scroll.x,this.lerpedScroll.y=this.scroll.y,this.preventTransforms||(e=!0,this.preventTransforms=!0)):(this.lerpedScroll.x=lerp(this.lerpedScroll.x,this.scroll.x,this.lerp),this.lerpedScroll.y=lerp(this.lerpedScroll.y,this.scroll.y,this.lerp),e=!0,this.preventTransforms=!1),e&&(this.emit("scroll",{scroll:this.scroll,lerpedScroll:this.lerpedScroll}),this.applyTransforms())}applyTransforms(o=!1){this.debug&&console.log("Lenis applyTransforms"),this.scrollbar&&this.scrollbar.transform(this.progress),!0===this.smooth&&(0<this.sections.length?this.sections.forEach(({offsetTop:e,height:t,element:s})=>{e-=this.lerpedScroll.y;(o||e<this.windowHeight+500&&-500<e+t)&&(s.style.transform=`translate3d(0,${-this.lerpedScroll.y}px,0)`)}):this.content.style.transform=`translate3d(0,${-this.lerpedScroll.y}px,0)`)}get limit(){return this.height-this.windowHeight}get progress(){return this.lerpedScroll.y/this.limit}}exports.default=Lenis;
//# sourceMappingURL=index.js.map
